<div class="jumbotron">
    <!-- Header -->
    <div class="requirements-header">
        <div class="row">
            <div class="col-md-8">
                <h2><i class="fa fa-trophy"></i> Team Requirements Dashboard</h2>
            </div>
            <div class="col-md-4 text-right">
                <div class="form-group">
                    <label>Select Year:</label>
                    <select class="form-control" ng-model="selectedYear" ng-options="year for year in yearsList">
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="requirements-summary" ng-if="summaryStats">
        <div class="row">
            <div class="col-md-3">
                <div class="stat-box">
                    <h3>{{summaryStats.complete}}/{{summaryStats.total}}</h3>
                    <p>Members Complete ({{summaryStats.percentage}}%)</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-box">
                    <h3>{{summaryStats.avgRaces}}</h3>
                    <p>Average Races</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-box">
                    <h3>{{summaryStats.avgVolunteer}}</h3>
                    <p>Average Volunteer Jobs</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-box">
                    <h4>Requirements</h4>
                    <p class="requirements-text">
                        <i class="fa fa-check-circle text-success"></i> 8+ races<br>
                        <i class="fa fa-check-circle text-success"></i> 70%+ age grade<br>
                        <span ng-if="volunteerRequirementApplies">
                            <i class="fa fa-check-circle text-success"></i> 2+ volunteer jobs
                        </span>
                        <span ng-if="!volunteerRequirementApplies" class="text-muted-custom">
                            <i class="fa fa-info-circle"></i> Volunteer jobs (N/A for {{selectedYear}})
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Requirements Table -->
    <div class="requirements-content">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4><i class="fa fa-list"></i> Member Requirements Status - {{selectedYear}}</h4>
            </div>
            <div class="panel-body no-padding">
                <div ng-if="loading" class="text-center loading-container">
                    <i class="fa fa-spinner fa-spin fa-3x"></i>
                    <p>Loading requirements data...</p>
                </div>

                <div ng-if="!loading && requirementsList.length === 0" class="text-center text-muted empty-container">
                    <i class="fa fa-info-circle"></i> No active members found for {{selectedYear}}.
                </div>

                <table class="table table-striped table-hover" ng-if="!loading && requirementsList.length > 0">
                    <thead>
                        <tr>
                            <th ng-click="setSortBy('member.lastname')" class="sortable">
                                Member
                                <i class="fa"
                                    ng-class="{'fa-sort-up': sortBy === 'member.lastname' && !sortReverse, 'fa-sort-down': sortBy === 'member.lastname' && sortReverse}"></i>
                            </th>
                            <th ng-click="setSortBy('raceCount')" class="sortable">
                                Races (≥8)
                                <i class="fa"
                                    ng-class="{'fa-sort-up': sortBy === 'raceCount' && !sortReverse, 'fa-sort-down': sortBy === 'raceCount' && sortReverse}"></i>
                            </th>
                            <th ng-click="setSortBy('maxAgeGrade')" class="sortable">
                                Best Age Grade (≥70%)
                                <i class="fa"
                                    ng-class="{'fa-sort-up': sortBy === 'maxAgeGrade' && !sortReverse, 'fa-sort-down': sortBy === 'maxAgeGrade' && sortReverse}"></i>
                            </th>
                            <th ng-click="setSortBy('volunteerJobCount')" class="sortable">
                                <span ng-if="volunteerRequirementApplies">Volunteer Jobs (≥2)</span>
                                <span ng-if="!volunteerRequirementApplies">Volunteer Jobs</span>
                                <i class="fa"
                                    ng-class="{'fa-sort-up': sortBy === 'volunteerJobCount' && !sortReverse, 'fa-sort-down': sortBy === 'volunteerJobCount' && sortReverse}"></i>
                            </th>
                            <th ng-click="setSortBy('meetsAllRequirements')" class="sortable">
                                Status
                                <i class="fa"
                                    ng-class="{'fa-sort-up': sortBy[0] === '-statusValue', 'fa-sort-down': sortBy[0] === 'statusValue'}"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="req in requirementsList | orderBy:sortBy:sortReverse"
                            ng-class="getStatusClass(req)">
                            <td>
                                <a ui-sref="/members/member({ member: req.member.username })">{{req.member.firstname}}
                                    {{req.member.lastname}}</a>
                                <i ng-if="req.joinedDuringYear" class="fa fa-sign-in text-success status-icon"
                                    title="Joined during {{selectedYear}}"></i>
                                <i ng-if="req.leftDuringYear" class="fa fa-sign-out text-warning status-icon"
                                    title="Left during {{selectedYear}}"></i>
                            </td>
                            <td>
                                <span
                                    ng-class="{'text-success': req.meetsRaceRequirement, 'text-danger': !req.meetsRaceRequirement}">
                                    <i class="fa"
                                        ng-class="{'fa-check-circle': req.meetsRaceRequirement, 'fa-times-circle': !req.meetsRaceRequirement}"></i>
                                    {{req.raceCount}}
                                </span>
                            </td>
                            <td>
                                <span
                                    ng-class="{'text-success': req.meetsAgeGradeRequirement, 'text-danger': !req.meetsAgeGradeRequirement}">
                                    <i class="fa"
                                        ng-class="{'fa-check-circle': req.meetsAgeGradeRequirement, 'fa-times-circle': !req.meetsAgeGradeRequirement}"></i>
                                    {{req.maxAgeGrade | number:1}}%
                                </span>
                            </td>
                            <td>
                                <span ng-if="req.volunteerRequirementApplies"
                                    ng-class="{'text-success': req.meetsVolunteerRequirement, 'text-danger': !req.meetsVolunteerRequirement}">
                                    <i class="fa"
                                        ng-class="{'fa-check-circle': req.meetsVolunteerRequirement, 'fa-times-circle': !req.meetsVolunteerRequirement}"></i>
                                    {{req.volunteerJobCount}}
                                </span>
                                <span ng-if="!req.volunteerRequirementApplies" class="text-muted-custom">
                                    {{req.volunteerJobCount}} <small>(N/A)</small>
                                </span>
                            </td>
                            <td>
                                <span class="status-badge" ng-class="getStatusClass(req)">
                                    {{getStatusText(req)}}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>